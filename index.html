<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const words = ["code","fast","type","game","sky","birds","speed","focus","react","skill","storm","cloud","fire","water","earth","stone","leaf","tree","sun","moon","jump","run","play","fun","joy","win","lose","hope","dream","wish","plan","build","create","grow","travel","explore","find","seek","catch","throw","kick"];

let activeWords = [];
let birds = [];
let score = 0;
let level = 1;
let fallSpeed = 1.5;
let nextLevelScore = 30;
let lives = 3;
let gameOver = false;
let spawnInterval = null;

// ✅ Sounds
const popSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const levelUpSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const lifeLostSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang.ogg");
const destroySound = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

// ✅ Creepy game over sound — properly preloaded
const gameOverSound = new Audio();
gameOverSound.src = "https://cdn.pixabay.com/download/audio/2021/08/04/audio_07d012c391.mp3?filename=horror-ambience-6036.mp3";
gameOverSound.preload = "auto";
gameOverSound.crossOrigin = "anonymous";

for (let i = 0; i < 8; i++) {
  birds.push({ x: Math.random() * canvas.width, y: Math.random() * (canvas.height / 2), speed: 1 + Math.random() * 1.5 });
}

function drawBirds() {
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  birds.forEach(bird => {
    ctx.beginPath();
    ctx.moveTo(bird.x, bird.y);
    ctx.quadraticCurveTo(bird.x + 10, bird.y - 5, bird.x + 20, bird.y);
    ctx.moveTo(bird.x + 20, bird.y);
    ctx.quadraticCurveTo(bird.x + 30, bird.y - 5, bird.x + 40, bird.y);
    ctx.stroke();
  });
}

function updateBirds() {
  birds.forEach(bird => {
    bird.x += bird.speed;
    if (bird.x > canvas.width + 50) {
      bird.x = -50;
      bird.y = Math.random() * (canvas.height / 2);
    }
  });
}

function spawnWord() {
  if (!gameOver) {
    const text = words[Math.floor(Math.random() * words.length)];
    const x = Math.random() * (canvas.width - 150);
    activeWords.push({ text, x, y: 0 });
  }
}

function drawWords() {
  ctx.font = "24px monospace";
  ctx.fillStyle = "white";
  activeWords.forEach(word => ctx.fillText(word.text, word.x, word.y));
}

function updateWords() {
  for (let i = 0; i < activeWords.length; i++) {
    activeWords[i].y += fallSpeed;
    if (activeWords[i].y > canvas.height) {
      activeWords.splice(i, 1);
      loseLife();
      i--;
    }
  }
}

// ✅ Letter-by-letter typing (front only)
function handleLetter(letter) {
  for (let i = 0; i < activeWords.length; i++) {
    let word = activeWords[i];
    if (word.text[0] === letter.toLowerCase()) {
      word.text = word.text.slice(1);
      popSound.currentTime = 0;
      popSound.play();
      score++;
      document.getElementById("score").textContent = "Score: " + score;
      if (word.text.length === 0) {
        activeWords.splice(i, 1);
        destroySound.currentTime = 0;
        destroySound.play();
        checkLevelUp();
      }
      return;
    }
  }
}

function checkLevelUp() {
  if (score >= nextLevelScore) {
    level++;
    fallSpeed += 1.5;
    nextLevelScore += 40;
    document.getElementById("level").textContent = "Level: " + level;
    levelUpSound.currentTime = 0;
    levelUpSound.play();
    const div = document.getElementById("levelUp");
    div.style.opacity = "1";
    setTimeout(() => div.style.opacity = "0", 1000);
  }
}

function loseLife() {
  lives--;
  lifeLostSound.currentTime = 0;
  lifeLostSound.play();
  document.getElementById("lives").textContent = "Lives: " + lives;
  if (lives <= 0) endGame();
}

function endGame() {
  gameOver = true;
  document.getElementById("gameOver").style.opacity = "1";
  document.getElementById("restartBtn").style.display = "block";

  // Stop other sounds
  popSound.pause();
  levelUpSound.pause();
  lifeLostSound.pause();
  destroySound.pause();

  // ✅ Play creepy sound safely
  gameOverSound.currentTime = 0;
  gameOverSound.volume = 1;
  gameOverSound.play().catch(e => console.log("Creepy sound blocked:", e));

  if (spawnInterval) {
    clearInterval(spawnInterval);
    spawnInterval = null;
  }
}

document.getElementById("restartBtn").addEventListener("click", () => {
  score = 0;
  level = 1;
  fallSpeed = 1.5;
  nextLevelScore = 30;
  lives = 3;
  activeWords = [];
  gameOver = false;
  document.getElementById("score").textContent = "Score: " + score;
  document.getElementById("level").textContent = "Level: " + level;
  document.getElementById("lives").textContent = "Lives: " + lives;
  document.getElementById("gameOver").style.opacity = "0";
  document.getElementById("restartBtn").style.display = "none";
  document.getElementById("tapStart").style.display = "block";
  if (spawnInterval) clearInterval(spawnInterval);
  spawnInterval = null;
});

const input = document.getElementById("inputField");
input.addEventListener("input", e => {
  const letter = e.target.value;
  if (letter) handleLetter(letter);
  e.target.value = "";
});

// ✅ Preload creepy sound after user interaction
const tapStart = document.getElementById("tapStart");
tapStart.addEventListener("click", () => {
  gameOverSound.play().then(() => {
    gameOverSound.pause();
    gameOverSound.currentTime = 0;
  });

  input.style.width = "100px";
  input.style.height = "30px";
  input.style.opacity = "0.5";
  input.style.zIndex = "1000";
  input.focus();

  setTimeout(() => {
    input.style.width = "1px";
    input.style.height = "1px";
    input.style.opacity = "0.01";
    input.style.zIndex = "-1";
  }, 500);

  tapStart.style.display = "none";
  startGame();
});

function startGame() {
  if (spawnInterval) clearInterval(spawnInterval);
  spawnInterval = setInterval(() => { if (!gameOver) spawnWord(); }, 2000);
  animate();
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  updateBirds();
  drawBirds();
  updateWords();
  drawWords();
  if (!gameOver) requestAnimationFrame(animate);
}

document.body.addEventListener("click", () => input.focus());
window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
  </script>
